deploy:
  branch: master
stairs:
  - name: test
    scope: project
    buildkite:
      queue: builder
      env:
        MAKE_CLEANUP_TARGET: true
      command:
        - cd $$PROJECT_PATH
        - make test
  - name: build
    scope: project
    emoji: ":docker:"
    buildkite:
      branches: "master"
      command:
        - cd $$PROJECT_PATH
        - make build
  - name: tag-release
    scope: stair
    emoji: ":github:"
    buildkite:
      branches: "master"
      command:
        - make tag-release
  - name: deploy-stg
    scope: project
    emoji: ":rocket:"
    deploy: true
    buildkite:
      branches: "master"
      command:
        - make deploy-stg
  - name: deploy-prd
    scope: project
    emoji: ":rocket:"
    deploy: true
    tags:
      - straight-to-prod
    buildkite:
      branches: "master"
      command:
        - make deploy-prd
projects:
  - name: sre
    path: sre
    emoji: ":buildkite:"
  - name: k8s
    path: k8s
    emoji: ":javascript:"
  - name: portals
    path: portals
    emoji: ":python:"
